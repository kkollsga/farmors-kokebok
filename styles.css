/* BASE STYLES */
body { font-family: 'Inter', sans-serif; }
body.modal-open { overflow: hidden; position: relative; touch-action: none; }
.font-display { font-family: 'Playfair Display', serif; }

/* SAFE AREA */
.safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0); }
.safe-top { padding-top: env(safe-area-inset-top, 0); }

/* SCROLLBAR */
.recipe-scroll::-webkit-scrollbar { width: 6px; }
.recipe-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
.recipe-scroll::-webkit-scrollbar-thumb { background: #d4d4d4; border-radius: 3px; }
.recipe-scroll::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

/* SEARCH BAR POSITIONING */
.search-bar-fixed { 
    position: fixed; 
    top: calc(env(safe-area-inset-top, 0px) + 12px); 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 50; 
}

/* Allow bar to expand based on content, with min/max constraints */
#unifiedGlassBar { 
    min-height: 48px;
    height: auto;
    max-height: 80px;
    transition: min-height 0.3s ease-out, max-height 0.3s ease-out, padding 0.3s ease-out; 
}

#standardContent.hidden, #minimumContent.hidden { display: none !important; }

/* Add padding to minimum content for better spacing */
#minimumContent { 
    padding: 4px 0;
}

/* Allow pills to wrap if needed */
#minimumContent .inline-flex {
    flex-wrap: wrap;
    gap: 0.5rem;
}

/* FILTER DROPDOWN */
#filterOptions { overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }
#filterOptions {
    background: linear-gradient(white 30%, rgba(255,255,255,0)) center top,
                linear-gradient(rgba(255,255,255,0), white 70%) center bottom,
                linear-gradient(white, white) center;
    background-size: 100% 40px, 100% 40px, 100% 100%;
    background-attachment: local, local, scroll;
    background-repeat: no-repeat;
}

/* ANIMATIONS */
@keyframes tipHighlight {
    from { transform: translateX(-10px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
}

/* CARD TRANSITIONS */
[data-recipe-id] { transition: opacity 0.3s ease-out; }
.recipe-counter { transition: transform 0.2s ease-out; }
.recipe-stars i { transition: color 0.2s ease-out, transform 0.2s ease-out; }

/* RECOMMENDATIONS */
#recommendedRecipes { transition: min-height 0.3s ease-out; position: relative; }
#recommendedRecipes > div { transition: opacity 0.3s ease-out, transform 0.3s ease-out; }

/* MODAL - Using dvh with --vvh fallback (Solution 3) */
#recipeModal .absolute.inset-0 { -webkit-overflow-scrolling: touch; overscroll-behavior: contain; }
#recipeModal .fixed.top-4.right-4 { transition: transform 0.2s ease-out; }
#recipeModal .fixed.top-4.right-4:active { transform: scale(0.95); }
#recipeModal .rounded-t-3xl { box-shadow: 0 -20px 40px rgba(0,0,0,0.3), 0 -10px 20px rgba(0,0,0,0.2); }

/* Modal height using dynamic viewport units with fallback */
#recipeModal .h-\[92vh\] {
    height: 92dvh;
    height: calc(var(--vvh, 1vh) * 92);
}

/* Fullscreen modal on mobile using dynamic viewport */
#recipeModal.fixed.inset-0 {
    height: 100dvh;
    height: calc(var(--vvh, 1vh) * 100);
}

/* DESKTOP MODAL */
@media (min-width: 901px) {
    #recipeModal .absolute.inset-0 { max-width: 1280px; margin: 0 auto; }
}

/* MOBILE RESPONSIVE */
@media (max-width: 768px) {
    #filterButtonText { display: none; }
    #searchInputContainer { min-width: 120px; }
    .search-bar-fixed { max-width: calc(100vw - 20px); }
}

/* RESPONSIVE SEARCH BAR - SMALL SCREENS */
@media (max-width: 500px) {
    #searchInputContainer {
        min-width: 80px !important;
        flex: 0 1 auto;
    }
    
    #filterPillsContainer .inline-flex {
        max-width: 80px;
    }
    
    #filterPillsContainer span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 60px;
    }
}

/* RESPONSIVE SEARCH BAR - MEDIUM SCREENS */
@media (min-width: 501px) and (max-width: 768px) {
    #searchInputContainer {
        min-width: 120px !important;
    }
    
    #filterPillsContainer .inline-flex {
        max-width: 100px;
    }
}

/* iOS SPECIFIC - Force 16px font size to prevent zoom */
@supports (-webkit-touch-callout: none) {
    input[type="text"], input[type="search"], textarea, select { font-size: 16px !important; }
}

/* iOS PWA MODAL SAFE AREA - Using dynamic viewport height */
@media screen and (max-width: 900px) {
    #recipeModal.fixed.inset-0.z-50:not(.bg-black) > div { 
        padding-top: max(env(safe-area-inset-top), 20px); 
    }
    
    /* Modal content wrapper height */
    #recipeModal .modal-height-mobile {
        height: 100dvh;
        height: calc(var(--vvh, 1vh) * 100);
    }
}

/* LANDSCAPE - Adjust for keyboard */
@media (orientation: landscape) and (max-width: 900px) {
    .search-bar-fixed { 
        top: calc(env(safe-area-inset-top, 0px) + 8px); 
    }
    
    /* Adjust modal in landscape to account for smaller viewport height */
    #recipeModal .h-full {
        height: 100dvh;
        height: calc(var(--vvh, 1vh) * 100);
    }
}

.text-shadow { text-shadow: 0 1px 3px rgba(0,0,0,0.5); }

/* FARMOR IMAGE EXPANSION */
.farmor-expanded {
    transform: scale(var(--scale-factor)) !important;
    z-index: 40;
    position: relative;
}

.farmor-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 39;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
}

.farmor-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

.signature-name {
    font-family: 'Kalam', cursive;
    font-weight: 700;
}

/* KOKEBOK VIEWER - Using dynamic viewport height */
#kokebokViewer {
    height: calc(100dvh - 5rem);
    height: calc((var(--vvh, 1vh) * 100) - 5rem);
}

@media (orientation: landscape) and (max-width: 900px) {
    #kokebokViewer {
        height: 100dvh;
        height: calc(var(--vvh, 1vh) * 100);
    }
}

/* MIN-HEIGHT UTILITIES - Using dynamic viewport with fallback */
.min-h-screen {
    min-height: 100dvh;
    min-height: calc(var(--vvh, 1vh) * 100);
}

/* HEIGHT UTILITIES - Using dynamic viewport with fallback */
.h-screen {
    height: 100dvh;
    height: calc(var(--vvh, 1vh) * 100);
}

/* iOS SAFARI KEYBOARD FIX - Ensure content respects visual viewport */
@supports (-webkit-touch-callout: none) {
    /* When keyboard is open, use visual viewport height */
    body {
        min-height: 100dvh;
        min-height: calc(var(--vvh, 1vh) * 100);
    }
    
    /* Fixed elements should respect safe area after keyboard dismissal */
    .search-bar-fixed {
        will-change: transform;
        backface-visibility: hidden;
    }
}